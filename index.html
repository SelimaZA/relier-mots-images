<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Relier images → mots (ligne droite)</title>
<style>
  :root{--gap:14px;--radius:14px;--shadow:0 6px 20px rgba(0,0,0,.08)}
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{margin:0;background:#f6f8fb;color:#1f2937}
  .wrap{max-width:1100px;margin:auto;padding:20px}
  .board{position:relative;display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
  .col{background:#fff;border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  h1{font-size:20px;margin:0 0 10px}

  /* images (gauche) */
  .images{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .imgbox{position:relative;border:2px dashed #d1d5db;border-radius:12px;overflow:hidden;background:#fafafa;}
  .imgbox img{width:100%;height:120px;object-fit:cover;display:block}
  .imgbox.drop-ok{border-color:#4f46e5}

  /* mots (droite) */
  .words{display:flex;flex-direction:column;gap:10px;min-height:420px}
  .word{padding:10px 12px;border-radius:12px;background:#eef2ff;border:2px solid #c7d2fe;cursor:grab;
        user-select:none;font-weight:600;width:220px}
  .word.dragging{opacity:.5}

  /* flèches (droites) */
  svg#lines{position:absolute;inset:0;pointer-events:none}
  line.arrow{stroke:#4f46e5;stroke-width:3;marker-end:url(#arrowhead)}

  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
  button{border:0;border-radius:12px;padding:10px 14px;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
  .primary{background:#4f46e5;color:#fff}
  .ghost{background:#e5e7eb}
  .ok{background:#10b981;color:#fff}
  .ko{background:#ef4444;color:#fff}
  .msg{margin-left:auto;font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <h1>Relie chaque <u>image</u> au <u>bon mot</u></h1>

  <!-- ⚙️ CONFIG : mets tes URL Dropbox (format ?raw=1) -->
  <script>
  const PAIRS = [
    { id:"markabon",    img:"assets/markabon.jpg",  word:"assets/markabon.jpg"},
    { id:"mi7fathaton",   img:"assets/mi7fathaton.jpg",   word:"assets/mi7fathaton.jpg"},
    { id:"mou3alimaton", img:"assets/mou3alimaton.jpg",  word:"assets/mou3alimaton.jpg"}
  ];
  </script>

  <div class="board" id="board">
    <!-- couche lignes -->
    <svg id="lines" viewBox="0 0 100 100" preserveAspectRatio="none">
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#4f46e5"></polygon>
        </marker>
      </defs>
    </svg>

    <!-- Colonne gauche : IMAGES (cibles) -->
    <div class="col">
      <h1>Images</h1>
      <div id="images" class="images"></div>
    </div>

    <!-- Colonne droite : MOTS (à glisser) -->
    <div class="col">
      <h1>Mots</h1>
      <div id="words" class="words"></div>
    </div>
  </div>

  <div class="row">
    <button id="check" class="primary">Vérifier</button>
    <button id="reset" class="ghost">Recommencer</button>
    <div id="msg" class="msg"></div>
  </div>
</div>

<script>
  const $board  = document.getElementById("board");
  const $lines  = document.getElementById("lines");
  const $images = document.getElementById("images");
  const $words  = document.getElementById("words");
  const map = new Map(); // wordId -> imageId

  function resizeSVG(){
    const r = $board.getBoundingClientRect();
    $lines.setAttribute("viewBox", `0 0 ${r.width} ${r.height}`);
  }
  window.addEventListener("resize", ()=>{ resizeSVG(); drawAll(); });

  function center(el){
    const r1 = $board.getBoundingClientRect();
    const r2 = el.getBoundingClientRect();
    return { x: r2.left - r1.left + r2.width/2, y: r2.top - r1.top + r2.height/2 };
  }

  // Rendu des images (cibles à gauche)
  PAIRS.slice().forEach(p=>{
    const box = document.createElement("div");
    box.className = "imgbox";
    box.dataset.accept = p.id;

    const img = document.createElement("img");
    img.src = p.img; img.alt = p.id;

    ["dragenter","dragover"].forEach(evt=>{
      box.addEventListener(evt, e=>{ e.preventDefault(); box.classList.add("drop-ok"); });
    });
    ["dragleave","drop"].forEach(evt=>{
      box.addEventListener(evt, e=>{ e.preventDefault(); box.classList.remove("drop-ok"); });
    });
    box.addEventListener("drop", e=>{
      const wordId = e.dataTransfer.getData("text/plain");
      map.set(wordId, p.id); // relie ce mot à cette image
      drawAll();
    });

    box.appendChild(img);
    $images.appendChild(box);
  });

  // Rendu des mots (draggables à droite)
  PAIRS.slice().sort(()=>Math.random()-0.5).forEach(p=>{
    const el = document.createElement("div");
    el.className = "word";
    el.textContent = p.word;
    el.draggable = true;
    el.dataset.id = p.id;

    el.addEventListener("dragstart", ev=>{
      ev.dataTransfer.setData("text/plain", p.id);
      el.classList.add("dragging");
    });
    el.addEventListener("dragend", ()=> el.classList.remove("dragging"));

    $words.appendChild(el);
  });

  // Dessin des droites
  function drawAll(){
    resizeSVG();
    $lines.querySelectorAll("line.arrow").forEach(n=>n.remove());
    for(const [wordId,imageId] of map.entries()){
      const wordEl  = [...document.querySelectorAll(".word")].find(w=>w.dataset.id===wordId);
      const imgBox  = [...document.querySelectorAll(".imgbox")].find(b=>b.dataset.accept===imageId);
      if(!wordEl || !imgBox) continue;
      const a = center(wordEl);
      const b = center(imgBox);
      const L = document.createElementNS("http://www.w3.org/2000/svg","line");
      L.classList.add("arrow");
      L.setAttribute("x1",a.x); L.setAttribute("y1",a.y);
      L.setAttribute("x2",b.x); L.setAttribute("y2",b.y);
      $lines.appendChild(L);
    }
  }

  // Vérifier
  const $msg = document.getElementById("msg");
  document.getElementById("check").addEventListener("click", ()=>{
    let ok = 0;
    PAIRS.forEach(p=>{
      if (map.get(p.id) === p.id) ok++;
    });
    document.querySelectorAll(".imgbox").forEach(t=>{
      const correct = map.get(t.dataset.accept) === t.dataset.accept;
      t.style.borderColor = correct ? "#10b981" : "#ef4444";
    });
    if (ok === PAIRS.length) { $msg.textContent = "Bravo !"; $msg.className = "msg ok"; }
    else { $msg.textContent = `${ok}/${PAIRS.length} correct(s)`; $msg.className = "msg ko"; }
  });

  // Reset
  document.getElementById("reset").addEventListener("click", ()=>{
    map.clear(); $msg.textContent = ""; $msg.className = "msg";
    document.querySelectorAll(".imgbox").forEach(t=> t.style.borderColor = "#d1d5db");
    drawAll();
  });

  resizeSVG();
</script>
</body>
</html>
