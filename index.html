<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Relier images â†” mots (clic-clic, pastilles & lignes)</title>
<style>
  :root{
    --gap:16px; --radius:16px; --shadow:0 6px 20px rgba(0,0,0,.08);
    --obj-border:#93c5fd;   /* bleu clair objets */
    --word-border:#f9a8d4;  /* rose clair mots */
    --line:#4f46e5;         /* indigo lignes */
    --ok:#10b981; --ko:#ef4444;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{margin:0;background:#f6f8fb;color:#1f2937}
  .wrap{max-width:1100px;margin:auto;padding:20px}
  h1{font-size:20px;margin:0 0 14px}

  /* Grille principale */
  .board{position:relative;display:grid;grid-template-columns:1fr 1fr;gap:var(--gap);align-items:start}
  .col{background:#fff;border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  .title{display:flex;align-items:center;gap:8px;margin:0 0 10px}
  .title .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
  .dot.obj{background:var(--obj-border)}
  .dot.word{background:var(--word-border)}

  /* Cartes */
  .list{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
  .card{
    position:relative;border-radius:14px;overflow:hidden;background:#fafafa;
    transition:transform .08s ease;border:2px solid transparent;min-height:150px
  }
  .card:hover{transform:translateY(-1px)}
  .card .img{width:100%;height:150px;object-fit:cover;display:block}
  .card .label{position:absolute;inset:auto 10px 10px auto;background:#111827;color:#fff;
               font-size:12px;padding:4px 8px;border-radius:999px;opacity:.8}
  /* DiffÃ©renciation visuelle */
  .card.obj{border-color:var(--obj-border); background:#f0f7ff}
  .card.word{border-color:var(--word-border); background:#fff0f6}

  /* Pastilles cliquables */
  .pin{
    position:absolute;top:50%;transform:translateY(-50%);width:18px;height:18px;border-radius:999px;
    border:3px solid #fff; box-shadow:0 0 0 2px rgba(0,0,0,.08); cursor:pointer;
    background:var(--line);
  }
  .pin.left{left:-9px}   /* sort un peu du cadre */
  .pin.right{right:-9px}
  .pin.active{box-shadow:0 0 0 4px rgba(79,70,229,.25)}

  /* Couche des lignes */
  svg#lines{position:absolute;inset:0;pointer-events:none}
  line.link{stroke:var(--line);stroke-width:3;stroke-linecap:round}
  circle.endcap{fill:#fff;stroke:var(--line);stroke-width:2}

  /* Barre dâ€™actions */
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
  button{border:0;border-radius:12px;padding:10px 14px;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
  .primary{background:#4f46e5;color:#fff}
  .ghost{background:#e5e7eb}
  .ok{background:var(--ok);color:#fff}
  .ko{background:var(--ko);color:#fff}
  .msg{margin-left:auto;font-weight:700}
  .hint{font-size:12px;color:#6b7280;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Relie chaque <u>image</u> au <u>bon mot</u> (clique les pastilles)</h1>

  <!-- âš™ï¸ CONFIG â€” remplace par tes chemins (dans /assets de ton repo) -->
  <script>
  const PAIRS = [
    // id = identifiant commun objet/mot (sans espace)
    // imgObj  = photo de l'objet (colonne gauche)
    // imgWord = image du mot (colonne droite)
    { id:"markabon",    imgObj:"assets/markabon_p.jpg",    imgWord:"assets/markabon.png" },
    { id:"mi7fathaton", imgObj:"assets/mi7fathaton_p.jpg", imgWord:"assets/mi7fathaton.png" },
    { id:"mou3alimaton",imgObj:"assets/mou3alimaton_p.jpg",imgWord:"assets/mou3alimaton.png" }
  ];
  </script>

  <div class="board" id="board">
    <!-- Lignes -->
    <svg id="lines" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>

    <!-- Colonne gauche : OBJETS -->
    <div class="col">
      <div class="title"><span class="dot obj"></span><strong>Images (objets)</strong></div>
      <div id="left" class="list"></div>
      <div class="hint">Clique la pastille âžœ puis la pastille correspondante Ã  droite.</div>
    </div>

    <!-- Colonne droite : MOTS (images) -->
    <div class="col">
      <div class="title"><span class="dot word"></span><strong>Mots (images)</strong></div>
      <div id="right" class="list"></div>
    </div>
  </div>

  <div class="row">
    <button id="check" class="primary">VÃ©rifier</button>
    <button id="reset" class="ghost">Recommencer</button>
    <div id="msg" class="msg"></div>
  </div>
</div>

<script>
  /* ========= DonnÃ©es & Ã©lÃ©ments ========= */
  const $board = document.getElementById('board');
  const $lines = document.getElementById('lines');
  const $left  = document.getElementById('left');
  const $right = document.getElementById('right');
  const map = new Map();         // wordId -> objId
  const pins = new Map();        // id -> { type:'obj'|'word', elPin, elCard }
  let startPin = null;           // pastille cliquÃ©e en premier
  let rafId = 0;
  let preview = null;            // { line, a:{x,y}, b:{x,y} }

  /* ========= Helpers ========= */
  function resizeSVG(){
    const r = $board.getBoundingClientRect();
    $lines.setAttribute('viewBox', `0 0 ${r.width} ${r.height}`);
  }
  function center(el){ // centre absolu (coordonnÃ©es relatives au board)
    const rb = $board.getBoundingClientRect();
    const r  = el.getBoundingClientRect();
    return { x: r.left - rb.left + r.width/2, y: r.top - rb.top + r.height/2 };
  }
  function makeCard(id, src, kind){ // kind: 'obj' | 'word'
    const card = document.createElement('div');
    card.className = `card ${kind}`;
    const img = document.createElement('img');
    img.className = 'img';
    img.decoding = 'async';
    img.loading = 'lazy';
    img.src = src; img.alt = id;
    const pin = document.createElement('button');
    pin.type = 'button';
    pin.className = 'pin ' + (kind==='obj' ? 'right' : 'left');
    pin.setAttribute('aria-label', `Point ${kind} ${id}`);
    card.append(img, pin);
    return { card, pin, img };
  }
  function addEndcaps(x1,y1,x2,y2){
    const a = document.createElementNS('http://www.w3.org/2000/svg','circle');
    a.setAttribute('cx',x1); a.setAttribute('cy',y1); a.setAttribute('r',6);
    a.setAttribute('class','endcap');
    const b = document.createElementNS('http://www.w3.org/2000/svg','circle');
    b.setAttribute('cx',x2); b.setAttribute('cy',y2); b.setAttribute('r',6);
    b.setAttribute('class','endcap');
    return [a,b];
  }
  function linkCoords(pinFrom, pinTo){
    return { a: center(pinFrom), b: center(pinTo) };
  }

  /* ========= Construction interface ========= */
  // Colonne gauche (objets)
  PAIRS.forEach(p=>{
    const {card, pin} = makeCard(p.id, p.imgObj, 'obj');
    $left.appendChild(card);
    pins.set(`obj:${p.id}`, {type:'obj', elPin:pin, elCard:card, id:p.id});
  });
  // Colonne droite (mots-images)
  PAIRS.slice().sort(()=>Math.random()-0.5).forEach(p=>{
    const {card, pin} = makeCard(p.id, p.imgWord, 'word');
    $right.appendChild(card);
    pins.set(`word:${p.id}`, {type:'word', elPin:pin, elCard:card, id:p.id});
  });

  resizeSVG();
  window.addEventListener('resize', ()=>{ resizeSVG(); drawAll(); });

  /* ========= Interaction clic-clic ========= */
  // start -> preview -> end (opposÃ©)
  pins.forEach(({elPin})=>{
    elPin.addEventListener('click', (e)=>{
      e.stopPropagation();
      const key = [...pins.entries()].find(([,v])=>v.elPin===elPin)[0];
      const cur = pins.get(key);

      if(!startPin){
        // dÃ©but dâ€™un lien
        startPin = cur;
        elPin.classList.add('active');
        startPreview(elPin);
      }else{
        // tentative dâ€™arrivÃ©e
        if(startPin.type === cur.type){
          // mÃªme colonne : on redÃ©marre depuis ce point
          clearPreview();
          startPin.elPin.classList.remove('active');
          startPin = cur;
          elPin.classList.add('active');
          startPreview(elPin);
          return;
        }
        // ok, on crÃ©e/replace le lien (word -> obj)
        const word = (startPin.type==='word') ? startPin : cur;
        const obj  = (startPin.type==='obj')  ? startPin : cur;
        map.set(word.id, obj.id);
        clearPreview();
        startPin.elPin.classList.remove('active');
        startPin = null;
        drawAll();
      }
    });
  });

  // aperÃ§u de ligne pendant le dÃ©placement de la souris
  function startPreview(fromPinEl){
    const l = document.createElementNS('http://www.w3.org/2000/svg','line');
    l.setAttribute('class','link');
    $lines.appendChild(l);
    preview = { line:l, fromEl:fromPinEl, mouse:{x:0,y:0} };

    const move = (ev)=>{
      preview.mouse.x = ev.clientX;
      preview.mouse.y = ev.clientY;
      if(!rafId){
        rafId = requestAnimationFrame(()=>{
          rafId = 0;
          const a = center(fromPinEl);
          const rb = $board.getBoundingClientRect();
          const b = { x: preview.mouse.x - rb.left, y: preview.mouse.y - rb.top };
          l.setAttribute('x1',a.x); l.setAttribute('y1',a.y);
          l.setAttribute('x2',b.x); l.setAttribute('y2',b.y);
        });
      }
    };
    const stop = ()=>{
      document.removeEventListener('mousemove', move, {passive:true});
      document.removeEventListener('mouseleave', stop);
    };
    document.addEventListener('mousemove', move, {passive:true});
    document.addEventListener('mouseleave', stop);
  }
  function clearPreview(){
    if(preview){
      preview.line.remove();
      preview = null;
    }
  }

  /* ========= Dessin des liens dÃ©finitifs ========= */
  function drawAll(){
    // nettoie tout
    while($lines.firstChild) $lines.firstChild.remove();

    // redessine toutes les liaisons word -> obj
    for(const [wordId,objId] of map.entries()){
      const w = pins.get(`word:${wordId}`)?.elPin;
      const o = pins.get(`obj:${objId}`)?.elPin;
      if(!w || !o) continue;

      const {a,b} = linkCoords(w,o);
      const L = document.createElementNS('http://www.w3.org/2000/svg','line');
      L.setAttribute('class','link');
      L.setAttribute('x1',a.x); L.setAttribute('y1',a.y);
      L.setAttribute('x2',b.x); L.setAttribute('y2',b.y);
      const [c1,c2] = addEndcaps(a.x,a.y,b.x,b.y);
      $lines.append(L,c1,c2);
    }
  }

  /* ========= VÃ©rifier & Reset ========= */
  const $msg = document.getElementById('msg');
  document.getElementById('check').addEventListener('click', ()=>{
    let ok = 0;
    PAIRS.forEach(p=>{
      if(map.get(p.id) === p.id) ok++;
    });
    // feedback cadre des cartes gauche
    document.querySelectorAll('.card.obj').forEach(card=>{
      const id = [...pins.values()].find(v=>v.elCard===card && v.type==='obj').id;
      const isOk = map.get(id) === id;
      card.style.borderColor = isOk ? 'var(--ok)' : 'var(--ko)';
    });
    $msg.textContent = (ok===PAIRS.length) ? 'Bravo ! Tout est correct ðŸŽ‰' : `${ok}/${PAIRS.length} correct(s)`;
    $msg.className = 'msg ' + (ok===PAIRS.length ? 'ok' : 'ko');
  });

  document.getElementById('reset').addEventListener('click', ()=>{
    map.clear();
    $msg.textContent=''; $msg.className='msg';
    document.querySelectorAll('.card').forEach(c=> c.style.borderColor='');
    clearPreview();
    if(startPin){ startPin.elPin.classList.remove('active'); startPin=null; }
    drawAll();
  });

  // premier sizing
  resizeSVG();
</script>
</body>
</html>
