<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Relier par des lignes – modèle autonome</title>
<style>
  :root{
    --gap:18px; --radius:18px; --shadow:0 6px 20px rgba(0,0,0,.08);
    --pin:#111; --line:#2b6ff0; --ok:#10b981; --ko:#ef4444;
    --left-bg:#f7fbff; --right-bg:#fff7fb; --left-b:#93c5fd; --right-b:#f9a8d4;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{margin:0;background:#f6f8fb;color:#0f172a}
  .wrap{max-width:1200px;margin:auto;padding:22px}
  h1{margin:0 0 14px;font-size:22px}

  .board{position:relative;display:grid;grid-template-columns:1fr 1fr;gap:var(--gap);align-items:start}
  .col{background:#fff;border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  .col.left  {background:var(--left-bg); border:2px solid var(--left-b)}
  .col.right {background:var(--right-bg);border:2px solid var(--right-b)}
  .list{display:grid;grid-template-columns:1fr;gap:12px}

  .card{position:relative;display:flex;align-items:center;gap:10px;
        padding:10px;border-radius:14px;background:#fff;box-shadow:var(--shadow);min-height:110px}
  .thumb{width:150px;height:100px;background:#fff;border-radius:10px;overflow:hidden;
         display:flex;align-items:center;justify-content:center;border:1px solid #e5e7eb}
  .thumb img{width:100%;height:100%;object-fit:contain;display:block}
  .label{font-weight:700}

  .pin{position:absolute;top:50%;transform:translateY(-50%);width:18px;height:18px;border-radius:999px;
       background:var(--pin);border:3px solid #fff;box-shadow:0 0 0 2px rgba(0,0,0,.1);cursor:pointer}
  .pin.left{left:-9px} .pin.right{right:-9px} .pin.active{box-shadow:0 0 0 4px rgba(43,111,240,.28)}

  svg#links{position:absolute;inset:0;pointer-events:none}
  line.seg{stroke:var(--line);stroke-width:3;stroke-linecap:round}
  circle.cap{fill:#fff;stroke:var(--line);stroke-width:2}

  .bar{display:flex;gap:12px;align-items:center;margin-top:18px;flex-wrap:wrap}
  button{border:0;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
  .danger{background:#e11d48;color:#fff}
  .primary{background:#1f51ff;color:#fff}
  .ghost{background:#e5e7eb}
  .msg{margin-left:auto;font-weight:800;min-width:160px}
  .toast{position:fixed;right:18px;bottom:18px;z-index:50;padding:12px 16px;border-radius:12px;
         color:#fff;font-weight:800;box-shadow:var(--shadow);display:none}
  .toast.ok{background:var(--ok)} .toast.ko{background:var(--ko)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Relie chaque image au bon mot/logo</h1>

  <!-- ======= CONFIG — ÉDITE ICI UNIQUEMENT ======= -->
  <script>
  // Colonne gauche (images d’objets)
  const LEFT = [
    { title: "Objet 1", img: "assets/left1.png" },
    { title: "Objet 2", img: "assets/left2.png" },
    { title: "Objet 3", img: "assets/left3.png" },
  ];
  // Colonne droite (mots-images / logos)
  const RIGHT = [
    { title: "Mot 1", img: "assets/right1.png" },
    { title: "Mot 2", img: "assets/right2.png" },
    { title: "Mot 3", img: "assets/right3.png" },
  ];
  // Correspondances correctes : [indexGauche, indexDroite]
  const SOLUTION = [
    [0,1],
    [1,0],
    [2,2],
  ];
  // Textes & feedback (GIFs optionnels)
  const TEXTS = {
    removeLast: "Supprimer la dernière ligne",
    validate  : "Valider",
    reset     : "Recommencer",
    scoreZero : "0 bonne réponse",
    youWin    : "Gagné",
    youLose   : "Erreur"
  };
  const FEEDBACK = {
    ok: "assets/win.gif",   // ou "" pour désactiver
    ko: "assets/error.gif"
  };
  </script>
  <!-- ============================================ -->

  <div class="board" id="board">
    <svg id="links" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>

    <div class="col left"><div id="leftList" class="list"></div></div>
    <div class="col right"><div id="rightList" class="list"></div></div>
  </div>

  <div class="bar">
    <button id="btnUndo"  class="danger">✖︎ <span id="tRemove"></span></button>
    <button id="btnCheck" class="primary">✔︎ <span id="tValidate"></span></button>
    <button id="btnReset" class="ghost">⟲ <span id="tReset"></span></button>
    <div id="score" class="msg"></div>
  </div>
</div>

<div id="toastOk" class="toast ok"></div>
<div id="toastKo" class="toast ko"></div>

<script>
/* === éléments & état === */
const $board=document.getElementById('board'), $svg=document.getElementById('links');
const $left=document.getElementById('leftList'), $right=document.getElementById('rightList');
const $score=document.getElementById('score'), $tOk=document.getElementById('toastOk'), $tKo=document.getElementById('toastKo');
document.getElementById('tRemove').textContent=TEXTS.removeLast;
document.getElementById('tValidate').textContent=TEXTS.validate;
document.getElementById('tReset').textContent=TEXTS.reset; $score.textContent=TEXTS.scoreZero;
$tOk.textContent=TEXTS.youWin; $tKo.textContent=TEXTS.youLose;

const pinsLeft=[], pinsRight=[], stack=[], links=new Map();
function boardRect(){return $board.getBoundingClientRect()}
function center(el){const b=boardRect(),r=el.getBoundingClientRect();return{x:r.left-b.left+r.width/2,y:r.top-b.top+r.height/2}}
function setViewBox(){const r=boardRect();$svg.setAttribute('viewBox',`0 0 ${r.width} ${r.height}`)}
function makeCard(item,side,idx){
  const card=document.createElement('div');card.className='card';
  const box=document.createElement('div');box.className='thumb';
  const img=document.createElement('img');img.src=item.img;img.alt=item.title;box.appendChild(img);
  const label=document.createElement('div');label.className='label';label.textContent=`P${idx} ${item.title}`;
  const pin=document.createElement('button');pin.type='button';pin.className='pin '+(side==='left'?'left':'right');
  card.append(box,label,pin); return {card,pin,img};
}
LEFT.forEach((it,i)=>{const {card,pin,img}=makeCard(it,'left',i);$left.appendChild(card);pinsLeft.push(pin);img.addEventListener('load',drawAll);});
RIGHT.forEach((it,i)=>{const {card,pin,img}=makeCard(it,'right',i);$right.appendChild(card);pinsRight.push(pin);img.addEventListener('load',drawAll);});
setViewBox();

/* === interaction clic-clic === */
let start=null;
function selectPin(side,index,el){
  if(!start){start={side,index,el};el.classList.add('active');return;}
  if(start.side===side){start.el.classList.remove('active');start={side,index,el};el.classList.add('active');return;}
  const L=(start.side==='left')?start.index:index;
  const R=(start.side==='right')?start.index:index;
  if(links.has(L)){const prevR=links.get(L);for(let s=stack.length-1;s>=0;s--){if(stack[s][0]===L){stack.splice(s,1);break;}}}
  links.set(L,R); stack.push([L,R]); start.el.classList.remove('active'); start=null; drawAll();
}
pinsLeft.forEach((p,i)=>p.addEventListener('click',()=>selectPin('left',i,p)));
pinsRight.forEach((p,i)=>p.addEventListener('click',()=>selectPin('right',i,p)));
document.addEventListener('click',(e)=>{if(start && !e.target.classList.contains('pin')){start.el.classList.remove('active');start=null}});

/* === dessin === */
function clearSVG(){while($svg.firstChild)$svg.firstChild.remove()}
function lineWithCaps(a,b){
  const L=document.createElementNS('http://www.w3.org/2000/svg','line');L.setAttribute('class','seg');
  L.setAttribute('x1',a.x);L.setAttribute('y1',a.y);L.setAttribute('x2',b.x);L.setAttribute('y2',b.y);
  const c1=document.createElementNS('http://www.w3.org/2000/svg','circle');c1.setAttribute('class','cap');c1.setAttribute('cx',a.x);c1.setAttribute('cy',a.y);c1.setAttribute('r',6);
  const c2=document.createElementNS('http://www.w3.org/2000/svg','circle');c2.setAttribute('class','cap');c2.setAttribute('cx',b.x);c2.setAttribute('cy',b.y);c2.setAttribute('r',6);
  $svg.append(L,c1,c2);
}
function drawAll(){setViewBox();clearSVG();links.forEach((R,L)=>{const a=center(pinsLeft[L]),b=center(pinsRight[R]);lineWithCaps(a,b);});}
window.addEventListener('resize',drawAll);window.addEventListener('scroll',()=>requestAnimationFrame(drawAll),{passive:true});

/* === actions === */
document.getElementById('btnUndo').addEventListener('click',()=>{const last=stack.pop();if(last){const[L]=last;links.delete(L);drawAll();}});
document.getElementById('btnReset').addEventListener('click',()=>{stack.length=0;links.clear();drawAll();$score.textContent=TEXTS.scoreZero;});
document.getElementById('btnCheck').addEventListener('click',()=>{
  let ok=0; SOLUTION.forEach(([L,R])=>{if(links.get(L)===R) ok++;});
  $score.textContent=`${ok}/${SOLUTION.length} bonne(s) réponse(s)`;
  const show=t=>{t.style.display='block';setTimeout(()=>t.style.display='none',1800);}
  if(ok===SOLUTION.length){
    if(FEEDBACK.ok){$tOk.style.backgroundImage='url('+FEEDBACK.ok+')';$tOk.style.backgroundSize='cover';$tOk.textContent='';}
    else{$tOk.textContent=TEXTS.youWin;} show($tOk);
  }else{
    if(FEEDBACK.ko){$tKo.style.backgroundImage='url('+FEEDBACK.ko+')';$tKo.style.backgroundSize='cover';$tKo.textContent='';}
    else{$tKo.textContent=TEXTS.youLose;} show($tKo);
  }
});
</script>
</body>
</html>
