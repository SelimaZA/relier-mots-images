<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Relier (style D-FIL, images sans cadres)</title>
<style>
  :root{ --line:#111; --pin:#111; --gap:40px; }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{margin:0; background:#f2ecda; /* remplace par ton fond, ou #fff */
        background-size:cover; color:#0f172a}

  .wrap{max-width:1100px;margin:auto;padding:24px}
  h1{margin:0 0 16px;font-size:24px}

  .stage{position:relative; display:grid; grid-template-columns:1fr 1fr; gap:var(--gap); align-items:center}
  .col{position:relative}

  /* images “nues”, pas de cadre/ombre */
  .item{position:relative; display:flex; align-items:center; gap:16px; margin:40px 0}
  .img{width:260px; height:auto; display:block; background:transparent}

  /* pastilles annulaire : anneau noir + cœur blanc */
  .pin{position:absolute; width:22px; height:22px; border-radius:999px;
       background:var(--pin); border:2px solid #fff; cursor:pointer}
  .pin::after{content:""; position:absolute; inset:4px; background:#fff; border-radius:999px}

  /* place les pastilles côté intérieur */
  .left  .pin{ right:-11px; top:50%; transform:translateY(-50%); }
  .right .pin{ left:-11px;  top:50%; transform:translateY(-50%); }
  .pin.active{box-shadow:0 0 0 5px rgba(0,0,0,.15)}

  /* lignes + cap ronds style D-FIL */
  svg#links{position:absolute; inset:0; pointer-events:none}
  line.seg{stroke:var(--line); stroke-width:7; stroke-linecap:round}
  circle.cap{fill:#fff; stroke:var(--line); stroke-width:3}

  /* barre d’actions centrée */
  .bar{display:flex; gap:12px; justify-content:center; align-items:center; margin-top:18px; flex-wrap:wrap}
  button{border:0; border-radius:12px; padding:12px 18px; font-weight:800; cursor:pointer}
  .danger{background:#e11d48; color:#fff} .primary{background:#1f51ff; color:#fff} .ghost{background:#e5e7eb}
  .score{min-width:180px; text-align:center; font-weight:800}
</style>
</head>
<body>
<div class="wrap">
  <h1>Relie chaque image au bon logo</h1>

  <!-- ========= CONFIG ========= -->
  <script>
  // Remplace par TES PNG à fond transparent (ou URLs complètes)
  const LEFT = [
    { img: "assets/markabon_p.png", title: "" },
    { img: "assets/mi7fathaton_p.png", title: "" },
    { img: "assets/mou3alimaton_p.png", title: "" },
  ];

  // Colonne droite : logos/mots (aussi des images)
  const RIGHT = [
    { img: "assets/markabon.png", title: "" },
    { img: "assets/mi7fathaton.png", title: "" },
    { img: "assets/mou3alimaton.png", title: "" },
  ];

  // exemple : perso1 -> logo2, perso2 -> logo1, perso3 -> logo3
  const SOLUTION = [[0,1],[1,0],[2,2]];
</script>

  <!-- ========================= -->

  <div class="stage" id="stage">
    <svg id="links" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>

    <div class="col left"  id="colL"></div>
    <div class="col right" id="colR"></div>
  </div>

  <div class="bar">
    <button id="undo"  class="danger">✖︎ Supprimer la dernière ligne</button>
    <button id="check" class="primary">✔︎ Valider</button>
    <button id="reset" class="ghost">⟲ Recommencer</button>
  </div>
  <div class="bar"><div id="score" class="score">0 bonne réponse</div></div>
</div>

<script>
/* ---- Construction ---- */
const $stage=document.getElementById('stage'), $svg=document.getElementById('links');
const $L=document.getElementById('colL'), $R=document.getElementById('colR');
const pinsL=[], pinsR=[], links=new Map(), stack=[];
function addItem(side, src){
  const box=document.createElement('div'); box.className='item';
  const img=document.createElement('img'); img.className='img'; img.src=src; img.alt="";
  const pin=document.createElement('button'); pin.type='button'; pin.className='pin';
  box.append(img,pin);
  if(side==='L'){ $L.appendChild(box); pinsL.push(pin); }
  else         { $R.appendChild(box); pinsR.push(pin); }
  img.addEventListener('load', drawAll);
}
LEFT .forEach(it=>addItem('L', it.img));
RIGHT.forEach(it=>addItem('R', it.img));

/* ---- Géométrie ---- */
function boardRect(){return $stage.getBoundingClientRect();}
function center(el){const b=boardRect(), r=el.getBoundingClientRect(); return {x:r.left-b.left+r.width/2, y:r.top-b.top+r.height/2};}
function setViewBox(){const r=boardRect(); $svg.setAttribute('viewBox', `0 0 ${r.width} ${r.height}`);}

/* ---- Lignes ---- */
function clearSVG(){while($svg.firstChild) $svg.firstChild.remove();}
function lineWithCaps(a,b){
  const L=document.createElementNS('http://www.w3.org/2000/svg','line');
  L.setAttribute('class','seg'); L.setAttribute('x1',a.x); L.setAttribute('y1',a.y); L.setAttribute('x2',b.x); L.setAttribute('y2',b.y);
  const c1=document.createElementNS('http://www.w3.org/2000/svg','circle'); c1.setAttribute('class','cap'); c1.setAttribute('cx',a.x); c1.setAttribute('cy',a.y); c1.setAttribute('r',7);
  const c2=document.createElementNS('http://www.w3.org/2000/svg','circle'); c2.setAttribute('class','cap'); c2.setAttribute('cx',b.x); c2.setAttribute('cy',b.y); c2.setAttribute('r',7);
  $svg.append(L,c1,c2);
}
function drawAll(){ setViewBox(); clearSVG(); links.forEach((R,L)=>{ lineWithCaps(center(pinsL[L]), center(pinsR[R])); }); }
window.addEventListener('resize', drawAll);
window.addEventListener('scroll', ()=>requestAnimationFrame(drawAll), {passive:true});

/* ---- Interaction clic-clic ---- */
let start=null;
function onPin(side, idx, el){
  if(!start){ start={side,idx,el}; el.classList.add('active'); return; }
  if(start.side===side){ start.el.classList.remove('active'); start={side,idx,el}; el.classList.add('active'); return; }
  const L = (start.side==='L') ? start.idx : idx;
  const R = (start.side==='R') ? start.idx : idx;
  if(links.has(L)){ for(let i=stack.length-1;i>=0;i--){ if(stack[i][0]===L){ stack.splice(i,1); break; } } }
  links.set(L,R); stack.push([L,R]);
  start.el.classList.remove('active'); start=null; drawAll();
}
pinsL.forEach((p,i)=>p.addEventListener('click',()=>onPin('L',i,p)));
pinsR.forEach((p,i)=>p.addEventListener('click',()=>onPin('R',i,p)));
document.addEventListener('click',e=>{ if(start && !e.target.classList.contains('pin')){ start.el.classList.remove('active'); start=null; }});

/* ---- Actions ---- */
const $score=document.getElementById('score');
document.getElementById('undo').addEventListener('click',()=>{ const last=stack.pop(); if(last){ const [L]=last; links.delete(L); drawAll(); }});
document.getElementById('reset').addEventListener('click',()=>{ stack.length=0; links.clear(); $score.textContent='0 bonne réponse'; drawAll(); });
document.getElementById('check').addEventListener('click',()=>{
  let ok=0; SOLUTION.forEach(([L,R])=>{ if(links.get(L)===R) ok++; });
  $score.textContent = `${ok}/${SOLUTION.length} bonne(s) réponse(s)`;
});
</script>
</body>
</html>
